## Заметка
Все сложные слова со сноской находятся в словаре. Ссылка на [[Словарь]]

## 1. Основы представления в SQL
Представления (Views) - это виртуальные таблицы, которые представляют собой результат выполнения SQL-запроса. Представления не хранят данные самостоятельно, они лишь содержат SQL-запрос, который выполняется каждый раз при обращении к представлению. Используя представления можно
+ Скрыть сложность базы данных, предоставляя упрощенный интерфейс к данным
+ Ограничить доступ к определенным данным для различны пользователей
+ Абстрагировать сложные запросы и использовать их в виде простого представления.
## 2. Создание и удаление представлений
+ **Создание представлений** выполняется с помощью оператора `CREATE VIEW` 
Пример 
```SQL
CREATE VIEW employees_view AS
SELECT employees_id, first_name, last_name, department
FROM employees
WHERE status = 'active';
```
Это представление показывает только активных сотрудников
+ Удаление представлений осуществляется с помощью оператора `DROP VIEW`
```SQL
DROP VIEW employee_view
```
## 3. Изменение существующих представлений без удаления
Для изменения представления можно использовать команду `CREATE OR REPLACE VIEW`, которая позволяет обновить представление не удаляя его
```SQL
CREATE OR REPLACE VIEW employees_view AS
SELECT employee_id, first_name, last_name, department, hire_date
FROM employees
WHERE status = 'active';
```
## 4. Преимущества использования представлений
+ **Безопасность**: представления могут ограничить доступ к определенным колонкам или строкам
+ **Упрощение запросов**: можно использовать представления для создания упрощенных интерфейсов к сложным данным.
+ **Поддержка совместимости**: при изменении структуры базы данных можно изменить представление ,а не все запросы, использующие эти данные.
## 5. Взаимодействие представлений с другим представлениями и таблицами
Представления могут быть основаны на других представлениях, а также могут комбинировать данные из различных таблиц. Например:
```SQL
CREATE VIEW department_view AS 
SELECT d.department_name, e.first_name, e.last_name
FROM departments d
JOIN employees e ON d.department_id = e.department_id;
```
## 6. Основы материализованных представлений и их отличия от обычных представлений
**Материализованные представления** - это представления, которые хранят результат SQL-запроса физически на диске.
В отличие от обычных представлений, материализованные представления содержат реальные данные, что позволяет ускорить выполнение запросов, но требует управления актуальностью данных

## 7. Создание и обновление материализованных представлений
Создание материализованного представления осуществляется с помощью оператора `CREATE MATERIALIZED VIEW`. Пример
```SQL
CREATE MATERIALIZED VIEW sales_summary AS
SELECT product_id, SUM(quantity) AS total_sales
FROM sales
GROUP BY product_id;
```
Для обновления данных в материализованном представлении используются команды `REFRESH MATERIALIZED VIEW`.
Пример: 
```SQL
REFRESH MATERIALIZED VIEW sales_summary;
```
## 8. Ограничения и преимущества материализованных представлений
**Преимущества**
+ Высокая скорость выполнения запросов, так как данные уже подготовлены. 
+ Возможность использовать индексы для ускорения доступа к данным
**Ограничения**
+ Требуется периодическое обновление данных
+ Материализованные представления занимают место на диске
## 9. Управление индексами в материализованных представлениях
Индексы можно создавать для ускорения доступа к данным в материализованных представлениях, так же как и для обычных таблиц. Пример:
```SQL
CREATE INDEX idx_product_sales ON sales_summary (product_id);
```
## 10. Производительность и актуальность данных в материализованных представлениях
Производительность запросов может значительно улучшиться при использовании материализованных представлений, так как данные уже агрегированны и сохранены. Однако, чтобы данные были актуальными, материализованные представления нужно обновлять с определенной периодичностью, используя либо ручное обновление, либо автоматическое.

## 11. Оптимизация запросов к материализованным представлениям
Оптимизация заключается в правильном выборе данных для материализованного представления, использовании индексов и настройке частоты обновления данных в зависимости от требований к актуальности.

## 12. Автоматическое и инкрементное обновление материализованных представлений
В некоторых СУБД (например,  PostgreSQL) можно настроить автоматическое обновление материализованных представлений. Например, с помощью триггеров или расписания обновлений. Инкрементное обновление позволяет обновлять только измененные данные, что значительно снижает нагрузку на систему.

## 13. Использование изменяемых представлений и синхронизации данных
Изменяемые представления позволяют вносить изменения в базовые таблицы через представления. Это достигается за счет использования триггеров или специальных операторов в СУБД, таких как `INSTEAD OF` в SQL Server: 
```SQL
CREATE TRIGGER trg_instead_of_update
ON employee_view
INSTEAD OF UPDATE
AS
BEGIN
	UPDATE employees
	SET first_name = inserted.first_name,
		last_name = inserted.last_name
	FROM employees, inserted
	WHERE employees.employee_id = inserted.employee_id;
END;
```

## 14. Влияние индексов на обновление матриализованных представлений
Индексы могут ускорять доступ к данным, но могут замедлить обновление материализованных представлений, так как индексы также нужно обновлять. Это нужно учитывать при настройке частоты обновлений.

## 15. Выбор между материализованными и обычными представлениями и влияние настроек SQL сервера на производительность

Выбор между обычными и материализованными представлениями зависит от требований к производительности и актуальности данных. Обычные представления подходят, если важна актуальность данных и допустимо снижение производительности. 
Материализованные представления применимы, когда важна скорость обработки запросов, а актуальность данных может обновляться с задержкой.

Настройки SQL сервера такие как размер кэша, использование параллельных запросов и планировщик запросов, также влияют на производительность как обычных, так и материализованных представлений

## Заключение 
Представления и материализованные представления в SQL являются мощными инструментами для оптимизации работы с базами данных, управления доступом и упрощения сложных запросов. Понимание того, когда и как их использовать. позволяет создавать более эффективные и масштабируемые системы.
